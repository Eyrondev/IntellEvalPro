<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Guidance Counselor Dashboard | IntellEvalPro</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/nclogo.png') }}">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.all.min.js"></script>
  
  <script>
    tailwind.config = {
      theme: {
        fontFamily: {
          'sans': ['Inter', 'system-ui', 'sans-serif'],
        },
        extend: {
          colors: {
            primary: {
              50: '#e6f0ff',
              100: '#b3d1ff',
              200: '#80b3ff',
              300: '#4d94ff', 
              400: '#1a75ff',
              500: '#0059cc',
              600: '#004db3',
              700: '#004099',
              800: '#003380',
              900: '#002766',
            },
            secondary: {
              50: '#f5f7fa',
              100: '#e4e7eb',
              200: '#cbd2d9',
              300: '#9aa5b1',
              400: '#7b8794',
              500: '#616e7c',
              600: '#52606d',
              700: '#3e4c59',
              800: '#323f4b',
              900: '#1f2933',
            },
          },
        }
      }
    }
  </script>
  
  <style>
    body {
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
    }
    .active-nav {
      background-color: #e6f0ff;
      color: #0059cc;
      border-left: 4px solid #0059cc;
    }
        /* Active nav link */
    .nav-link.active {
      position: relative;
    }
    
    .nav-link.active::after {
      content: '';
      position: absolute;
      left: 0;
      width: 4px;
      height: 100%;
      background-color: #0059cc;
      border-radius: 0 2px 2px 0;
    }
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    
    /* Card hover effect */
    .dashboard-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .dashboard-card:hover {
      transform: translateY(-2px);
    }
    
    /* Progress Bar Animation */
    .progress-bar {
      width: 0%;
      transition: width 1.2s ease-out;
    }
    
    /* Loading animation */
    .loading-spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #f97316;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Mobile responsive styles */
    @media (max-width: 768px) {
      .dashboard-card {
        margin-bottom: 0.75rem;
      }
      
      .text-3xl {
        font-size: 1.5rem !important;
        line-height: 2rem !important;
      }
      
      .text-2xl {
        font-size: 1.25rem !important;
        line-height: 1.75rem !important;
      }
      
      .text-xl {
        font-size: 1.125rem !important;
        line-height: 1.75rem !important;
      }
      
      table td,
      table th {
        padding: 0.5rem 0.5rem;
        font-size: 0.75rem;
      }
    }
    
    @media (max-width: 640px) {
      main {
        padding: 0.625rem !important;
      }
      
      .p-4,
      .p-5,
      .p-6 {
        padding: 0.875rem !important;
      }
      
      .gap-6 {
        gap: 0.75rem !important;
      }
      
      .gap-4 {
        gap: 0.625rem !important;
      }
    }
  </style>
</head>

<body class="bg-gray-50">


  <div class="flex h-screen bg-gray-50">
    <!-- Navigation Sidebar -->
    <div id="sidebar-container"></div>
    
    <!-- Main content -->
    <div class="flex-1 lg:ml-64">
      <!-- Header -->
      <div id="header-container"></div>

      <!-- Main content area -->
      <main class="flex-1 overflow-auto p-4 sm:p-6 bg-gray-50">
        <!-- Welcome Banner -->
        <div class="bg-gradient-to-r from-primary-600 to-primary-800 rounded-lg shadow-md mb-6">
          <div class="p-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between">
              <div class="flex-1">
                <h2 class="text-2xl font-bold text-white">Dashboard</h2>
                <p class="mt-2 text-sm text-primary-100">
                  Academic Year: <span class="font-medium text-white">2025-2026 - 1st Semester</span> | Real-time monitoring
                </p>
              </div>
              <div class="flex gap-2 mt-4 md:mt-0">
                <a href="{{ url_for('guidance.ai_analytics_dashboard') }}" class="inline-flex items-center px-4 py-2 bg-white text-primary-700 text-sm font-medium rounded-md hover:bg-primary-50 transition-colors duration-200">
                  <i class="fas fa-chart-line mr-2"></i>
                  Analytics
                </a>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Overview Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
          <!-- Total Faculty -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 dashboard-card overflow-hidden">
            <div class="p-6">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <p class="text-sm font-medium text-gray-600 mb-2">Total Faculty</p>
                  <div class="flex items-baseline">
                    <h3 class="text-3xl font-bold text-gray-900" id="total-faculty">--</h3>
                    <span class="ml-2 inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-green-50 text-green-700">
                      <i class="fas fa-arrow-up text-xs mr-1"></i>
                      Active
                    </span>
                  </div>
                  <p class="text-xs text-gray-500 mt-2">
                    <span id="total-departments">--</span> departments
                  </p>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-primary-500 to-primary-600 flex items-center justify-center shadow-lg">
                  <i class="fas fa-users text-white text-lg"></i>
                </div>
              </div>
            </div>
            <div class="h-1 bg-gradient-to-r from-primary-500 to-primary-600"></div>
          </div>
          
          <!-- Active Programs -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 dashboard-card overflow-hidden">
            <div class="p-6">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <p class="text-sm font-medium text-gray-600 mb-2">Active Programs</p>
                  <div class="flex items-baseline">
                    <h3 class="text-3xl font-bold text-gray-900" id="active-programs">--</h3>
                  </div>
                  <p class="text-xs text-gray-500 mt-2">Academic programs</p>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg">
                  <i class="fas fa-building text-white text-lg"></i>
                </div>
              </div>
            </div>
            <div class="h-1 bg-gradient-to-r from-blue-500 to-blue-600"></div>
          </div>
          
          <!-- Student Evaluation Progress -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 dashboard-card overflow-hidden">
            <div class="p-6">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <p class="text-sm font-medium text-gray-600 mb-2">Student Progress</p>
                  <div class="flex items-baseline">
                    <h3 class="text-3xl font-bold text-gray-900" id="completion-rate">0.0%</h3>
                  </div>
                  <p class="text-xs text-gray-500 mt-2">
                    <span id="completed-students">0</span>/<span id="total-students">0</span> students completed
                  </p>
                  <div class="w-full bg-gray-100 rounded-full h-2 mt-3">
                    <div class="bg-gradient-to-r from-green-500 to-green-600 h-2 rounded-full progress-bar" id="completion-rate-bar"></div>
                  </div>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg">
                  <i class="fas fa-user-check text-white text-lg"></i>
                </div>
              </div>
            </div>
            <div class="h-1 bg-gradient-to-r from-green-500 to-green-600"></div>
          </div>
          
          <!-- Average Rating -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 dashboard-card overflow-hidden">
            <div class="p-6">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <p class="text-sm font-medium text-gray-600 mb-2">Avg Rating</p>
                  <div class="flex items-baseline">
                    <h3 class="text-3xl font-bold text-gray-900" id="average-rating">0.0</h3>
                    <span class="text-sm text-gray-500 font-medium ml-1">/5.0</span>
                  </div>
                  <div class="flex items-center mt-2" id="rating-stars">
                    <i class="far fa-star text-gray-300 text-sm"></i>
                    <i class="far fa-star text-gray-300 text-sm"></i>
                    <i class="far fa-star text-gray-300 text-sm"></i>
                    <i class="far fa-star text-gray-300 text-sm"></i>
                    <i class="far fa-star text-gray-300 text-sm"></i>
                  </div>
                  <div class="w-full bg-gray-100 rounded-full h-2 mt-3">
                    <div class="bg-gradient-to-r from-yellow-400 to-yellow-500 h-2 rounded-full progress-bar" id="average-rating-bar"></div>
                  </div>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-yellow-400 to-yellow-500 flex items-center justify-center shadow-lg">
                  <i class="fas fa-star text-white text-lg"></i>
                </div>
              </div>
            </div>
            <div class="h-1 bg-gradient-to-r from-yellow-400 to-yellow-500"></div>
          </div>
        </div>
        
        <!-- Charts Section -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
          <!-- Performance Trends -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 dashboard-card">
            <div class="p-6 border-b border-gray-100">
              <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">Performance Trends</h3>
                  <p class="text-sm text-gray-500 mt-1">Average ratings over evaluation periods</p>
                </div>
                <div class="mt-4 sm:mt-0">
                  <select id="period-filter" class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                    <option value="all">All Periods</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="p-6">
              <div class="h-80">
                <canvas id="performance-trends-chart"></canvas>
              </div>
            </div>
          </div>
          
          <!-- Rating Distribution -->
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 dashboard-card">
            <div class="p-6 border-b border-gray-100">
              <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">Rating Distribution</h3>
                  <p class="text-sm text-gray-500 mt-1">Faculty performance breakdown</p>
                </div>
                <div class="mt-4 sm:mt-0">
                  <select id="department-filter" class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                    <option value="all">All Departments</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="p-6">
              <div class="h-80">
                <canvas id="rating-distribution-chart"></canvas>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Top Faculty Rankings -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 dashboard-card">
          <div class="p-6 border-b border-gray-100">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
              <div>
                <h3 class="text-lg font-semibold text-gray-900">Top Faculty Rankings</h3>
                <p class="text-sm text-gray-500 mt-1">Highest performing faculty this period</p>
              </div>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Rank</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Faculty</th>
                  <th scope="col" class="hidden sm:table-cell px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Department</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Rating</th>
                  <th scope="col" class="hidden md:table-cell px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Evaluations</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-100" id="faculty-rankings-table">
                <tr>
                  <td colspan="5" class="px-6 py-12 text-center">
                    <div class="flex flex-col items-center justify-center">
                      <div class="loading-spinner mb-4"></div>
                      <p class="text-sm text-gray-500">Loading faculty rankings...</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  </div>
  <script src="{{ url_for('static', filename='js/loading-animation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/guidance-navigation.js') }}"></script>
  <script>
    // Global variables
    let performanceTrendsChart = null;
    let ratingDistributionChart = null;
    let dashboardData = {
      totalFaculty: 0,
      totalDepartments: 0,
      evaluatedFaculty: 0,
      completionRate: 0,
      averageRating: 0.0,
      facultyRankings: []
    };

    // Initialize dashboard
    $(document).ready(function() {
      // Load navigation
      loadGuidanceNavigation('guidance-dashboard');
      
      // Load dashboard data
      loadDashboardData();
      
      // Initialize charts
      initializeCharts();
      
      // Load filter data
      loadPeriods();
      loadDepartments();
      
      // Load chart data
      loadPerformanceTrends();
      loadRatingDistribution();
      
      // Add event handlers for filters
      $('#department-filter').on('change', function() {
        const selectedDept = $(this).val();
        loadRatingDistribution(selectedDept);
      });
      
      $('#period-filter').on('change', function() {
        const selectedPeriod = $(this).val();
        loadPerformanceTrends(selectedPeriod);
      });
      
      // Hide loader
      setTimeout(() => {
        $('#loader-overlay').fadeOut();
      }, 1000);
    });

    // Load dashboard data
    function loadDashboardData() {
      $.ajax({
        url: '/guidance/api/dashboard-stats',
        method: 'GET',
        success: function(response) {
          if (response.success) {
            updateDashboardCards(response.data);
            loadFacultyRankings();
          } else {
            console.error('Error loading dashboard data:', response.message);
            showErrorState();
          }
        },
        error: function(xhr, status, error) {
          console.error('AJAX Error loading dashboard data:', error);
          showErrorState();
        }
      });
    }

    // Update dashboard cards
    function updateDashboardCards(data) {
      dashboardData = data;
      
      // Update card values
      $('#total-faculty').text(data.totalFaculty || 0);
      $('#total-departments').text(data.totalDepartments || 0);
      $('#active-programs').text(data.totalDepartments || 0);
      
      // Update student evaluation progress (new student-based tracking)
      $('#total-students').text(data.totalStudents || 0);
      $('#completed-students').text(data.completedStudents || 0);
      $('#completion-rate').text((data.studentCompletionRate || 0).toFixed(1) + '%');
      $('#average-rating').text((data.averageRating || 0).toFixed(1));
      
      // Update progress bars with student completion rate
      setTimeout(() => {
        $('#completion-rate-bar').css('width', (data.studentCompletionRate || 0) + '%');
        $('#average-rating-bar').css('width', ((data.averageRating || 0) / 5.0 * 100) + '%');
      }, 500);
      
      // Update rating stars
      updateRatingStars(data.averageRating || 0);
    }

    // Update rating stars
    function updateRatingStars(rating) {
      const starsContainer = $('#rating-stars');
      starsContainer.empty();
      
      const fullStars = Math.floor(rating);
      const hasHalf = (rating - fullStars) >= 0.5;
      
      for (let i = 0; i < fullStars; i++) {
        starsContainer.append('<i class="fas fa-star text-yellow-400 text-sm"></i>');
      }
      
      if (hasHalf) {
        starsContainer.append('<i class="fas fa-star-half-alt text-yellow-400 text-sm"></i>');
      }
      
      for (let i = fullStars + (hasHalf ? 1 : 0); i < 5; i++) {
        starsContainer.append('<i class="far fa-star text-yellow-400 text-sm"></i>');
      }
    }

    // Show error state
    function showErrorState() {
      $('#total-faculty').text('--');
      $('#total-departments').text('--');
      $('#active-programs').text('--');
      $('#total-students').text('--');
      $('#completed-students').text('--');
      $('#completion-rate').text('0.0%');
      $('#average-rating').text('0.0');
    }

    // Load faculty rankings
    function loadFacultyRankings() {
      $.ajax({
        url: '/guidance/api/faculty-rankings',
        method: 'GET',
        data: { limit: 5 },
        success: function(response) {
          if (response.success) {
            displayFacultyRankings(response.rankings || []);
          } else {
            showEmptyRankings();
          }
        },
        error: function(xhr, status, error) {
          console.error('Error loading faculty rankings:', error);
          showEmptyRankings();
        }
      });
    }

    // Display faculty rankings
    function displayFacultyRankings(rankings) {
      const tbody = $('#faculty-rankings-table');
      tbody.empty();

      if (rankings.length === 0) {
        showEmptyRankings();
        return;
      }

      rankings.forEach((faculty, index) => {
        const rank = index + 1;
        const medalIcon = rank === 1 ? 'fa-trophy' : 'fa-medal';
        const medalColor = rank === 1 ? 'text-yellow-500' : (rank === 2 ? 'text-gray-400' : 'text-orange-400');
        const bgColor = rank === 1 ? 'bg-gradient-to-r from-yellow-50 to-orange-50' : 
                       (rank === 2 ? 'bg-gradient-to-r from-gray-50 to-slate-50' : 
                        'bg-gradient-to-r from-orange-50 to-amber-50');
        
        const initials = faculty.name.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase();
        
        const row = `
          <tr class="${bgColor} hover:shadow-sm transition-all duration-200">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <i class="fas ${medalIcon} ${medalColor} text-lg mr-2"></i>
                <span class="text-sm font-bold text-gray-900">${rank}</span>
              </div>
            </td>
            <td class="px-6 py-4">
              <div class="flex items-center">
                <div class="h-10 w-10 rounded-lg bg-gradient-to-br from-primary-500 to-primary-600 flex items-center justify-center shadow-md mr-3">
                  <span class="text-white font-bold text-sm">${initials}</span>
                </div>
                <div>
                  <div class="text-sm font-semibold text-gray-900">${faculty.name}</div>
                  <div class="text-xs text-gray-500 sm:hidden">${faculty.department || 'N/A'}</div>
                </div>
              </div>
            </td>
            <td class="hidden sm:table-cell px-6 py-4">
              <div class="text-sm text-gray-900">${faculty.department || 'N/A'}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex flex-col">
                <span class="text-lg font-bold text-green-600">${(faculty.avg_rating || 0).toFixed(1)}</span>
                <div class="flex">${generateStars(faculty.avg_rating || 0)}</div>
              </div>
            </td>
            <td class="hidden md:table-cell px-6 py-4 whitespace-nowrap">
              <span class="text-sm text-gray-600">${faculty.evaluation_count || 0} evals</span>
            </td>
          </tr>
        `;
        tbody.append(row);
      });
    }

    // Generate stars HTML
    function generateStars(rating) {
      let html = '';
      const fullStars = Math.floor(rating);
      const hasHalf = (rating - fullStars) >= 0.5;
      
      for (let i = 0; i < fullStars; i++) {
        html += '<i class="fas fa-star text-yellow-400 text-xs"></i>';
      }
      
      if (hasHalf) {
        html += '<i class="fas fa-star-half-alt text-yellow-400 text-xs"></i>';
      }
      
      for (let i = fullStars + (hasHalf ? 1 : 0); i < 5; i++) {
        html += '<i class="far fa-star text-yellow-400 text-xs"></i>';
      }
      
      return html;
    }

    // Show empty rankings
    function showEmptyRankings() {
      const tbody = $('#faculty-rankings-table');
      tbody.html(`
        <tr>
          <td colspan="5" class="px-6 py-12 text-center">
            <div class="flex flex-col items-center justify-center">
              <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4">
                <i class="fas fa-chart-line text-gray-400 text-2xl"></i>
              </div>
              <p class="text-sm text-gray-500 font-medium">No faculty rankings available yet</p>
              <p class="text-xs text-gray-400 mt-1">Evaluations are needed to generate rankings</p>
            </div>
          </td>
        </tr>
      `);
    }

    // Initialize charts
    function initializeCharts() {
      // Performance Trends Chart
      const perfCtx = document.getElementById('performance-trends-chart');
      if (perfCtx) {
        performanceTrendsChart = new Chart(perfCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: []
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              }
            },
            scales: {
              y: {
                beginAtZero: false,
                min: 0,
                max: 5.0,
                ticks: {
                  stepSize: 0.5
                }
              }
            }
          }
        });
      }

      // Rating Distribution Chart
      const ratingCtx = document.getElementById('rating-distribution-chart');
      if (ratingCtx) {
        ratingDistributionChart = new Chart(ratingCtx, {
          type: 'doughnut',
          data: {
            labels: ['Outstanding', 'Highly Satisfactory', 'Satisfactory', 'Needs Improvement', 'Poor'],
            datasets: [{
              data: [0, 0, 0, 0, 0],
              backgroundColor: [
                'rgba(34, 197, 94, 0.8)',
                'rgba(59, 130, 246, 0.8)',
                'rgba(251, 191, 36, 0.8)',
                'rgba(249, 115, 22, 0.8)',
                'rgba(239, 68, 68, 0.8)'
              ],
              borderColor: [
                'rgb(34, 197, 94)',
                'rgb(59, 130, 246)',
                'rgb(251, 191, 36)',
                'rgb(249, 115, 22)',
                'rgb(239, 68, 68)'
              ],
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              }
            }
          }
        });
      }
    }

    // Load evaluation periods
    function loadPeriods() {
      $.ajax({
        url: '/api/guidance/evaluation-periods',
        method: 'GET',
        success: function(response) {
          if (response.success && response.data) {
            const select = $('#period-filter');
            response.data.forEach(period => {
              select.append(`<option value="${period.period_id}">${period.title}</option>`);
            });
          }
        },
        error: function(xhr, status, error) {
          console.error('Error loading periods:', error);
        }
      });
    }

    // Load departments
    function loadDepartments() {
      $.ajax({
        url: '/guidance/api/departments-list',
        method: 'GET',
        success: function(response) {
          if (response.success && response.departments) {
            const select = $('#department-filter');
            response.departments.forEach(dept => {
              select.append(`<option value="${dept}">${dept}</option>`);
            });
          }
        },
        error: function(xhr, status, error) {
          console.error('Error loading departments:', error);
        }
      });
    }

    // Load performance trends data
    function loadPerformanceTrends(period = 'all') {
      $.ajax({
        url: '/guidance/api/performance-trends',
        method: 'GET',
        data: { period: period },
        success: function(response) {
          if (response.success && performanceTrendsChart) {
            performanceTrendsChart.data = response.data;
            performanceTrendsChart.update();
          }
        },
        error: function(xhr, status, error) {
          console.error('Error loading performance trends:', error);
        }
      });
    }

    // Load rating distribution data
    function loadRatingDistribution(department = 'all') {
      $.ajax({
        url: '/guidance/api/rating-distribution',
        method: 'GET',
        data: { department: department },
        success: function(response) {
          if (response.success && ratingDistributionChart) {
            ratingDistributionChart.data = response.data;
            ratingDistributionChart.update();
          }
        },
        error: function(xhr, status, error) {
          console.error('Error loading rating distribution:', error);
        }
      });
    }
  </script>
  
  <!-- Load navigation scripts -->
  <script src="{{ url_for('static', filename='js/loading-animation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/guidance-navigation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/prevent-back-logout.js') }}"></script>
  <script src="{{ url_for('static', filename='js/session-timeout.js') }}"></script>
</body>
</html>