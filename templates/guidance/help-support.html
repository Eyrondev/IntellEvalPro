<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Help & Support | IntellEvalPro</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/nclogo.png') }}">
  <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='images/nclogo.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/nclogo.png') }}">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.all.min.js"></script>
  
  <script>
    tailwind.config = {
      theme: {
        fontFamily: {
          'sans': ['Inter', 'system-ui', 'sans-serif'],
        },
        extend: {
          colors: {
            primary: {
              50: '#e6f0ff',
              100: '#b3d1ff',
              200: '#80b3ff',
              300: '#4d94ff', 
              400: '#1a75ff',
              500: '#0059cc',
              600: '#004db3',
              700: '#004099',
              800: '#003380',
              900: '#002966'
            }
          }
        }
      }
    }
  </script>
  
  <style>
    /* Active nav link */
    .active-nav {
      background-color: #e6f0ff;
      color: #0059cc;
      border-left: 4px solid #0059cc;
    }
  </style>
</head>
<body class="bg-gray-50 font-sans overflow-x-hidden">
  
  <!-- Loading overlay -->
  <div id="loader-overlay" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-white bg-opacity-90 backdrop-blur-sm transition-opacity duration-300">
    <img src="{{ url_for('static', filename='images/nclogo.png') }}" alt="Logo" class="w-32 h-auto mb-6 animate-bounce">
    <div class="flex items-center space-x-2">
      <div class="w-3 h-3 rounded-full bg-primary-500 animate-pulse"></div>
      <div class="w-3 h-3 rounded-full bg-primary-500 animate-pulse" style="animation-delay: 0.2s"></div>
      <div class="w-3 h-3 rounded-full bg-primary-500 animate-pulse" style="animation-delay: 0.4s"></div>
    </div>
  </div>

  <div class="flex h-screen bg-gray-50">
    <!-- Sidebar (will be loaded dynamically) -->
    <div id="sidebar-container"></div>
    
    <!-- Main content -->
    <div class="lg:ml-64 flex flex-col flex-1 min-h-screen">
      <!-- Top Navigation (will be loaded dynamically) -->
      <div id="header-container"></div>

      <!-- Main content area -->
      <main id="main-content" class="flex-1 overflow-auto p-4 md:p-6 bg-gray-50">
        <!-- Page header -->
        <div class="mb-6">
          <h1 class="text-2xl font-bold text-gray-800">Help & Support</h1>
          <p class="text-gray-500 mt-1">Find answers to common questions and get assistance with IntellEvalPro guidance features</p>
        </div>

        <!-- Quick Help Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <!-- System Management -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer" onclick="scrollToSection('system-management')">
            <div class="flex items-center mb-4">
              <div class="p-3 rounded-lg bg-blue-100">
                <i class="fas fa-cogs text-blue-600 text-xl"></i>
              </div>
              <h3 class="text-lg font-semibold text-gray-900 ml-3">System Management</h3>
            </div>
            <p class="text-gray-600">Learn how to manage evaluation periods, students, and faculty data</p>
          </div>

          <!-- Evaluation Analytics -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer" onclick="scrollToSection('analytics-help')">
            <div class="flex items-center mb-4">
              <div class="p-3 rounded-lg bg-green-100">
                <i class="fas fa-chart-line text-green-600 text-xl"></i>
              </div>
              <h3 class="text-lg font-semibold text-gray-900 ml-3">Analytics & Reports</h3>
            </div>
            <p class="text-gray-600">Understand evaluation analytics, reports, and performance metrics</p>
          </div>

          <!-- Technical Support -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer" onclick="scrollToSection('contact-support')">
            <div class="flex items-center mb-4">
              <div class="p-3 rounded-lg bg-purple-100">
                <i class="fas fa-headset text-purple-600 text-xl"></i>
              </div>
              <h3 class="text-lg font-semibold text-gray-900 ml-3">Technical Support</h3>
            </div>
            <p class="text-gray-600">Get technical assistance and contact our support team</p>
          </div>
        </div>

        <!-- FAQ Section -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
          <div class="p-6 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">Frequently Asked Questions</h2>
          </div>
          <div class="p-6">
            <!-- Search FAQ -->
            <div class="mb-6">
              <div class="relative">
                <input type="text" id="faq-search" placeholder="Search FAQ..." class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
            </div>

            <!-- System Management FAQs -->
            <div id="system-management" class="mb-8">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-cogs text-primary-600 mr-2"></i>
                System Management
              </h3>
              <div class="space-y-4">
                <div class="faq-item border border-gray-200 rounded-lg">
                  <button class="faq-question w-full text-left px-4 py-3 font-medium text-gray-900 hover:bg-gray-50 focus:outline-none flex items-center justify-between">
                    How do I create a new evaluation period?
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                  </button>
                  <div class="faq-answer hidden px-4 pb-3 text-gray-600">
                    To create a new evaluation period, go to Evaluation Management > Evaluation Periods. Click "Create New Period" and fill in the required details including period name, start/end dates, and description. Make sure to set the appropriate faculty and courses for the evaluation.
                  </div>
                </div>

                <div class="faq-item border border-gray-200 rounded-lg">
                  <button class="faq-question w-full text-left px-4 py-3 font-medium text-gray-900 hover:bg-gray-50 focus:outline-none flex items-center justify-between">
                    How can I monitor student evaluation progress?
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                  </button>
                  <div class="faq-answer hidden px-4 pb-3 text-gray-600">
                    Use the Student Management section to view real-time progress of student evaluations. You can see completion rates, pending evaluations, and enable retake options for students who need to resubmit their evaluations.
                  </div>
                </div>

                <div class="faq-item border border-gray-200 rounded-lg">
                  <button class="faq-question w-full text-left px-4 py-3 font-medium text-gray-900 hover:bg-gray-50 focus:outline-none flex items-center justify-between">
                    What's the difference between questionnaire types?
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                  </button>
                  <div class="faq-answer hidden px-4 pb-3 text-gray-600">
                    The questionnaire builder offers different question types: Multiple Choice (single selection), Checkboxes (multiple selections), Rating Scales (numeric ratings), Likert Scales (agreement levels), and Text fields (open responses). Choose based on the type of feedback you want to collect.
                  </div>
                </div>
              </div>
            </div>

            <!-- Analytics & Reports FAQs -->
            <div id="analytics-help" class="mb-8">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-chart-line text-primary-600 mr-2"></i>
                Analytics & Reports
              </h3>
              <div class="space-y-4">
                <div class="faq-item border border-gray-200 rounded-lg">
                  <button class="faq-question w-full text-left px-4 py-3 font-medium text-gray-900 hover:bg-gray-50 focus:outline-none flex items-center justify-between">
                    How do I generate faculty performance reports?
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                  </button>
                  <div class="faq-answer hidden px-4 pb-3 text-gray-600">
                    Go to Reports & Analytics > Faculty Performance. Select the evaluation period, faculty members, and report format. You can generate comprehensive reports including ratings analysis, student feedback, and performance trends over time.
                  </div>
                </div>

                <div class="faq-item border border-gray-200 rounded-lg">
                  <button class="faq-question w-full text-left px-4 py-3 font-medium text-gray-900 hover:bg-gray-50 focus:outline-none flex items-center justify-between">
                    What metrics are available in response analytics?
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                  </button>
                  <div class="faq-answer hidden px-4 pb-3 text-gray-600">
                    Response Analytics provides completion rates, response patterns, rating distributions, comment sentiment analysis, and trend comparisons. You can filter by department, course, or time period to get detailed insights into evaluation patterns.
                  </div>
                </div>

                <div class="faq-item border border-gray-200 rounded-lg">
                  <button class="faq-question w-full text-left px-4 py-3 font-medium text-gray-900 hover:bg-gray-50 focus:outline-none flex items-center justify-between">
                    How can I export evaluation data?
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                  </button>
                  <div class="faq-answer hidden px-4 pb-3 text-gray-600">
                    Most reports include export options in multiple formats (PDF, Excel, CSV). Look for the export button in the top-right corner of report pages. You can also schedule automated report generation for regular periods.
                  </div>
                </div>
              </div>
            </div>

            <!-- Technical Support FAQs -->
            <div id="technical-support" class="mb-8">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-tools text-primary-600 mr-2"></i>
                Technical Support
              </h3>
              <div class="space-y-4">
                <div class="faq-item border border-gray-200 rounded-lg">
                  <button class="faq-question w-full text-left px-4 py-3 font-medium text-gray-900 hover:bg-gray-50 focus:outline-none flex items-center justify-between">
                    What browsers are supported?
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                  </button>
                  <div class="faq-answer hidden px-4 pb-3 text-gray-600">
                    IntellEvalPro works best with modern browsers including Chrome 90+, Firefox 88+, Safari 14+, and Edge 90+. For optimal performance, ensure JavaScript is enabled and your browser is up to date.
                  </div>
                </div>

                <div class="faq-item border border-gray-200 rounded-lg">
                  <button class="faq-question w-full text-left px-4 py-3 font-medium text-gray-900 hover:bg-gray-50 focus:outline-none flex items-center justify-between">
                    How do I reset my password?
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                  </button>
                  <div class="faq-answer hidden px-4 pb-3 text-gray-600">
                    You can reset your password from the Settings page under Security & Privacy. You'll need to enter your current password and then create a new one. For account lockouts, contact your system administrator.
                  </div>
                </div>

                <div class="faq-item border border-gray-200 rounded-lg">
                  <button class="faq-question w-full text-left px-4 py-3 font-medium text-gray-900 hover:bg-gray-50 focus:outline-none flex items-center justify-between">
                    What should I do if data isn't loading?
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                  </button>
                  <div class="faq-answer hidden px-4 pb-3 text-gray-600">
                    First, check your internet connection and refresh the page. If the issue persists, try clearing your browser cache or try a different browser. For ongoing issues, use the contact form below to reach technical support.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Contact Support Section -->
        <div id="contact-support" class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
          <div class="p-6 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">Contact Support</h2>
            <p class="text-gray-600 mt-1">Can't find what you're looking for? Get in touch with our support team</p>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Contact Information -->
              <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Get in Touch</h3>
                <div class="space-y-4">
                  <div class="flex items-center">
                    <div class="p-2 rounded-lg bg-blue-100 mr-3">
                      <i class="fas fa-envelope text-blue-600"></i>
                    </div>
                    <div>
                      <p class="font-medium text-gray-900">Email Support</p>
                      <p class="text-gray-600">support@intellevalpro.edu</p>
                    </div>
                  </div>
                  <div class="flex items-center">
                    <div class="p-2 rounded-lg bg-green-100 mr-3">
                      <i class="fas fa-phone text-green-600"></i>
                    </div>
                    <div>
                      <p class="font-medium text-gray-900">Phone Support</p>
                      <p class="text-gray-600">+63 (2) 123-4567</p>
                    </div>
                  </div>
                  <div class="flex items-center">
                    <div class="p-2 rounded-lg bg-purple-100 mr-3">
                      <i class="fas fa-clock text-purple-600"></i>
                    </div>
                    <div>
                      <p class="font-medium text-gray-900">Support Hours</p>
                      <p class="text-gray-600">Mon-Fri: 8:00 AM - 5:00 PM</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Support Request Form -->
              <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Send Support Request</h3>
                <form class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
                    <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="Brief description of your issue">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                      <option value="low">Low - General question</option>
                      <option value="medium">Medium - Issue affecting work</option>
                      <option value="high">High - System down or urgent</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="Please describe your issue in detail..."></textarea>
                  </div>
                  <button type="submit" class="w-full px-4 py-2 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
                    Send Support Request
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
          <div class="p-6 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">Quick Links</h2>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <a href="{{ url_for('guidance.questionnaire_management') }}" class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                <i class="fas fa-clipboard-list text-primary-600 mr-3"></i>
                <span class="text-gray-900">Manage Questionnaires</span>
              </a>
              <a href="{{ url_for('guidance.evaluation_periods') }}" class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                <i class="fas fa-calendar-alt text-primary-600 mr-3"></i>
                <span class="text-gray-900">Evaluation Periods</span>
              </a>
              <a href="{{ url_for('analytics.faculty_performance') }}" class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                <i class="fas fa-chart-line text-primary-600 mr-3"></i>
                <span class="text-gray-900">Faculty Performance</span>
              </a>
              <a href="{{ url_for('guidance.guidance_dashboard') }}" class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                <i class="fas fa-gauge-high text-primary-600 mr-3"></i>
                <span class="text-gray-900">Dashboard</span>
              </a>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- AI Chatbot Widget -->
  <div id="ai-chatbot-container" class="fixed bottom-6 right-6 z-50">
    <!-- Chat Button -->
    <button id="chat-toggle-btn" class="bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-full p-4 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 flex items-center justify-center">
      <i class="fas fa-robot text-2xl"></i>
      <span class="ml-2 font-medium hidden md:inline">AI Assistant</span>
    </button>

    <!-- Chat Window -->
    <div id="chat-window" class="hidden absolute bottom-20 right-0 w-96 max-w-[calc(100vw-3rem)] bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col" style="height: 500px; max-height: calc(100vh - 8rem);">
      <!-- Chat Header -->
      <div class="bg-gradient-to-r from-primary-600 to-primary-700 text-white p-4 flex items-center justify-between">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center mr-3">
            <i class="fas fa-robot text-primary-600 text-xl"></i>
          </div>
          <div>
            <h3 class="font-semibold text-lg">IntellEval Assistant</h3>
            <p class="text-xs text-primary-100">Powered by Gemini AI</p>
          </div>
        </div>
        <button id="chat-close-btn" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-colors">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Chat Messages -->
      <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
        <!-- Welcome Message -->
        <div class="flex items-start">
          <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
            <i class="fas fa-robot text-primary-600 text-sm"></i>
          </div>
          <div class="bg-white rounded-lg rounded-tl-none p-3 shadow-sm max-w-[80%]">
            <p class="text-sm text-gray-800">Hi! ðŸ‘‹ I'm your IntellEvalPro AI Assistant for Guidance Counselors. I can help you with system management, evaluation analytics, report generation, and troubleshooting. How can I assist you today?</p>
          </div>
        </div>
      </div>

      <!-- Chat Input -->
      <div class="border-t border-gray-200 p-4 bg-white">
        <form id="chat-form" class="flex items-center space-x-2">
          <input 
            type="text" 
            id="chat-input" 
            placeholder="Ask me anything about IntellEvalPro..." 
            class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm"
            autocomplete="off"
          />
          <button 
            type="submit" 
            id="chat-send-btn"
            class="bg-primary-600 text-white rounded-full p-2 hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed w-10 h-10 flex items-center justify-center"
          >
            <i class="fas fa-paper-plane"></i>
          </button>
        </form>
        <p class="text-xs text-gray-500 mt-2 text-center">AI responses are based on system documentation</p>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // FAQ functionality
      const faqQuestions = document.querySelectorAll('.faq-question');
      faqQuestions.forEach(question => {
        question.addEventListener('click', function() {
          const answer = this.nextElementSibling;
          const icon = this.querySelector('i.fa-chevron-down');
          
          if (answer.classList.contains('hidden')) {
            answer.classList.remove('hidden');
            icon.classList.add('rotate-180');
          } else {
            answer.classList.add('hidden');
            icon.classList.remove('rotate-180');
          }
        });
      });

      // FAQ search functionality
      const searchInput = document.getElementById('faq-search');
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const faqItems = document.querySelectorAll('.faq-item');
        
        faqItems.forEach(item => {
          const question = item.querySelector('.faq-question').textContent.toLowerCase();
          const answer = item.querySelector('.faq-answer').textContent.toLowerCase();
          
          if (question.includes(searchTerm) || answer.includes(searchTerm)) {
            item.style.display = '';
          } else {
            item.style.display = 'none';
          }
        });
      });

      // Support form submission
      const supportForm = document.querySelector('#contact-support form');
      supportForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (typeof Swal !== 'undefined') {
          Swal.fire({
            icon: 'success',
            title: 'Support Request Sent',
            text: 'Your support request has been submitted. We\'ll get back to you within 24 hours.',
            confirmButtonColor: '#0059cc'
          });
        }
        
        this.reset();
      });
    });

    // Scroll to section function
    function scrollToSection(sectionId) {
      const element = document.getElementById(sectionId);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
  </script>

  <script>
    // Load navigation
    $(document).ready(function() {
      loadGuidanceNavigation('help-support');

      // AI Chatbot Functionality
      const chatToggleBtn = $('#chat-toggle-btn');
      const chatWindow = $('#chat-window');
      const chatCloseBtn = $('#chat-close-btn');
      const chatForm = $('#chat-form');
      const chatInput = $('#chat-input');
      const chatMessages = $('#chat-messages');
      const chatSendBtn = $('#chat-send-btn');

      // Toggle chat window
      chatToggleBtn.click(function() {
        chatWindow.toggleClass('hidden');
        if (!chatWindow.hasClass('hidden')) {
          chatInput.focus();
        }
      });

      // Close chat window
      chatCloseBtn.click(function() {
        chatWindow.addClass('hidden');
      });

      // Handle chat form submission
      chatForm.submit(function(e) {
        e.preventDefault();
        const message = chatInput.val().trim();
        
        if (!message) return;

        // Add user message to chat
        addUserMessage(message);
        chatInput.val('');
        
        // Disable input while processing
        chatInput.prop('disabled', true);
        chatSendBtn.prop('disabled', true);
        
        // Show typing indicator
        showTypingIndicator();

        // Send message to AI
        $.ajax({
          url: '/api/ai-support-chat',
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ 
            message: message,
            role: 'guidance'
          }),
          success: function(response) {
            removeTypingIndicator();
            if (response.success) {
              addAiMessage(response.reply);
            } else {
              addAiMessage('Sorry, I encountered an error. Please try again or check the FAQs above.');
            }
          },
          error: function() {
            removeTypingIndicator();
            addAiMessage('Sorry, I\'m having trouble connecting right now. Please try again in a moment.');
          },
          complete: function() {
            chatInput.prop('disabled', false);
            chatSendBtn.prop('disabled', false);
            chatInput.focus();
          }
        });
      });

      function addUserMessage(message) {
        const messageHtml = `
          <div class="flex items-start justify-end">
            <div class="bg-primary-600 text-white rounded-lg rounded-tr-none p-3 shadow-sm max-w-[80%]">
              <p class="text-sm">${escapeHtml(message)}</p>
            </div>
            <div class="w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center ml-2 flex-shrink-0">
              <i class="fas fa-user text-white text-sm"></i>
            </div>
          </div>
        `;
        chatMessages.append(messageHtml);
        scrollChatToBottom();
      }

      function addAiMessage(message) {
        const messageHtml = `
          <div class="flex items-start">
            <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
              <i class="fas fa-robot text-primary-600 text-sm"></i>
            </div>
            <div class="bg-white rounded-lg rounded-tl-none p-3 shadow-sm max-w-[80%]">
              <p class="text-sm text-gray-800">${formatAiMessage(message)}</p>
            </div>
          </div>
        `;
        chatMessages.append(messageHtml);
        scrollChatToBottom();
      }

      function showTypingIndicator() {
        const typingHtml = `
          <div class="flex items-start typing-indicator">
            <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
              <i class="fas fa-robot text-primary-600 text-sm"></i>
            </div>
            <div class="bg-white rounded-lg rounded-tl-none p-3 shadow-sm">
              <div class="flex space-x-1">
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0s"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
              </div>
            </div>
          </div>
        `;
        chatMessages.append(typingHtml);
        scrollChatToBottom();
      }

      function removeTypingIndicator() {
        $('.typing-indicator').remove();
      }

      function scrollChatToBottom() {
        chatMessages.scrollTop(chatMessages[0].scrollHeight);
      }

      function escapeHtml(text) {
        const map = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
      }

      function formatAiMessage(message) {
        // Convert **bold** to <strong>
        message = message.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
        // Convert line breaks
        message = message.replace(/\n/g, '<br>');
        // Convert bullet points
        message = message.replace(/^- (.+)$/gm, 'â€¢ $1');
        return message;
      }
    });
  </script>

  <style>
    /* Chatbot animations */
    #chat-window {
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #chat-toggle-btn {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 10px 15px -3px rgba(0, 89, 204, 0.3);
      }
      50% {
        box-shadow: 0 10px 25px -3px rgba(0, 89, 204, 0.5);
      }
    }

    /* Custom scrollbar for chat */
    #chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    #chat-messages::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    #chat-messages::-webkit-scrollbar-thumb {
      background: #cbd5e0;
      border-radius: 10px;
    }

    #chat-messages::-webkit-scrollbar-thumb:hover {
      background: #a0aec0;
    }
  </style>

  <!-- Include scripts -->
  <script src="{{ url_for('static', filename='js/loading-animation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/guidance-navigation.js') }}"></script>

  <!-- Prevent logout on browser back button -->
  <script src="{{ url_for('static', filename='js/prevent-back-logout.js') }}"></script>

  <!-- Session Timeout Monitor (Auto-logout after 1 hour) -->
  <script src="{{ url_for('static', filename='js/session-timeout.js') }}"></script>

</body>
</html>