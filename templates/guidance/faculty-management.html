<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Faculty Management | IntellEvalPro</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/nclogo.png') }}">
  <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='images/nclogo.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/nclogo.png') }}">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.all.min.js"></script>
  
  <script>
    tailwind.config = {
      theme: {
        fontFamily: {
          'sans': ['Inter', 'system-ui', 'sans-serif'],
        },
        extend: {
          colors: {
            primary: {
              50: '#e6f0ff',
              100: '#b3d1ff',
              200: '#80b3ff',
              300: '#4d94ff', 
              400: '#1a75ff',
              500: '#0059cc',
              600: '#004db3',
              700: '#004099',
              800: '#003380',
              900: '#002766'
            }
          }
        }
      }
    }
  </script>
  
  <style>
    /* Global styles */
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
      width: 100%;
      margin: 0;
      padding: 0;
    }
    
    html {
      overflow-x: hidden;
      width: 100%;
    }
    
    /* Active nav link */
    .active-nav {
      background-color: #e6f0ff;
      color: #0059cc;
      border-left: 4px solid #0059cc;
    }
    
    .nav-link.active {
      position: relative;
    }
    
    .nav-link.active::after {
      content: '';
      position: absolute;
      left: 0;
      width: 4px;
      height: 100%;
      background-color: #0059cc;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    
    /* Card hover effect */
    .dashboard-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .dashboard-card:hover {
      transform: translateY(-2px);
    }
    
    /* Mobile responsive styles - 390px minimum baseline */
    @media (max-width: 768px) {
      body {
        overflow-x: hidden;
        width: 100%;
      }
      
      /* Ensure main content doesn't overflow */
      main {
        width: 100%;
        padding-left: 0.75rem !important;
        padding-right: 0.75rem !important;
      }
      
      /* Reduce heading sizes on mobile */
      h1 {
        font-size: 1.5rem !important;
        line-height: 2rem !important;
      }
      
      h3 {
        font-size: 1rem !important;
        line-height: 1.5rem !important;
      }
      
      /* Make tables scrollable on mobile */
      .overflow-x-auto {
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        overflow-x: auto;
        max-width: 100%;
      }
      
      /* Compact table cells on mobile */
      table td,
      table th {
        padding: 0.5rem 0.5rem;
        font-size: 0.75rem;
      }
      
      /* Hide less important columns on mobile */
      .hide-mobile {
        display: none;
      }
      
      /* Full screen modal on mobile */
      #faculty-modal > div {
        top: 0 !important;
        margin: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
        height: 100vh !important;
        border-radius: 0 !important;
        overflow-y: auto;
      }
    }
    
    /* Extra small mobile - 390px baseline */
    @media (max-width: 640px) {
      /* Optimize main padding */
      main {
        padding: 0.625rem !important;
        width: 100% !important;
        max-width: 100vw !important;
      }
      
      /* Compact headings */
      h1 {
        font-size: 1.375rem !important;
        margin-bottom: 0.5rem !important;
      }
      
      /* Reduce card padding */
      .bg-white.rounded-lg {
        padding: 0.75rem !important;
      }
      
      /* Stack filters vertically */
      .filter-container {
        flex-direction: column !important;
        gap: 0.75rem !important;
      }
      
      /* Full width filters */
      .filter-container > div {
        width: 100% !important;
      }
      
      /* Compact search input */
      input[type="text"],
      select {
        font-size: 0.875rem;
        padding: 0.5rem 0.75rem;
        min-height: 44px;
      }
      
      /* Further reduce table text */
      table td,
      table th {
        padding: 0.375rem 0.5rem;
        font-size: 0.7rem;
        white-space: nowrap;
      }
      
      /* Stack action buttons */
      .action-buttons {
        flex-direction: column;
        gap: 0.25rem;
        align-items: flex-start;
      }
      
      .action-buttons button {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        width: 100%;
        text-align: left;
      }
      
      /* Show 2 columns for summary stats on mobile */
      .stats-grid {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      
      /* Optimize stat card padding */
      .dashboard-card .p-3 {
        padding: 0.5rem !important;
      }
      
      /* Smaller icon containers */
      .dashboard-card .w-8 {
        width: 1.75rem !important;
        height: 1.75rem !important;
      }
      
      .dashboard-card .w-8 i {
        font-size: 0.7rem !important;
      }
      
      /* Modal adjustments for small mobile */
      #faculty-modal .relative {
        padding: 0.75rem !important;
      }
      
      #modal-content {
        font-size: 0.875rem;
      }
    }
    
    /* Very small mobile - 390px specific optimizations */
    @media (max-width: 480px) {
      /* Further optimize spacing */
      main {
        padding: 0.5rem !important;
      }
      
      /* Smaller heading */
      h1 {
        font-size: 1.25rem !important;
      }
      
      /* Compact page description */
      p.text-gray-600 {
        font-size: 0.8125rem;
      }
      
      /* Tighter stat cards */
      .stats-grid {
        gap: 0.5rem !important;
      }
      
      /* Even smaller stats */
      .dashboard-card dt {
        font-size: 0.65rem !important;
      }
      
      .dashboard-card dd {
        font-size: 0.875rem !important;
      }
      
      /* Compact table further */
      table td,
      table th {
        padding: 0.25rem 0.375rem;
        font-size: 0.65rem;
      }
      
      /* Smaller badges */
      .inline-flex.px-2 {
        padding: 0.125rem 0.375rem !important;
        font-size: 0.625rem !important;
      }
      
      /* Modal title smaller */
      #faculty-modal h3 {
        font-size: 0.9375rem !important;
      }
    }
    
    /* Tablet responsive styles */
    @media (min-width: 641px) and (max-width: 1023px) {
      /* Show more columns on tablet */
      .hide-mobile {
        display: table-cell;
      }
      
      /* Adjust table font size for tablet */
      table td,
      table th {
        font-size: 0.8125rem;
        padding: 0.625rem 0.75rem;
      }
      
      /* Two columns for stats on tablet */
      .stats-grid {
        grid-template-columns: repeat(2, 1fr) !important;
      }
    }
    
    /* Desktop and large screens - Enhanced readability */
    @media (min-width: 1024px) {
      /* Larger table text for better readability */
      table td,
      table th {
        font-size: 0.9375rem;
        line-height: 1.5;
      }
      
      table thead th {
        font-size: 0.8125rem;
        font-weight: 600;
      }
    }
    
    /* Extra large screens - Even better readability */
    @media (min-width: 1280px) {
      table td,
      table th {
        font-size: 1rem;
        line-height: 1.6;
      }
      
      table thead th {
        font-size: 0.875rem;
      }
    }
    
    /* Ultra-wide screens - Maximum readability */
    @media (min-width: 1536px) {
      table td,
      table th {
        font-size: 1.0625rem;
        padding: 1rem 1.5rem;
      }
      
      table thead th {
        font-size: 0.9375rem;
      }
    }
    
    /* Touch-friendly interactions */
    @media (hover: none) and (pointer: coarse) {
      /* Ensure 44x44px minimum touch targets */
      button,
      a,
      select,
      input {
        min-height: 44px;
        padding: 0.625rem 0.75rem;
      }
      
      /* Remove hover effects on touch devices */
      .dashboard-card:hover {
        transform: none;
      }
      
      /* Touch-friendly dropdowns */
      select {
        font-size: 16px; /* Prevent zoom on iOS */
      }
      
      /* Larger tap targets for links */
      a {
        padding: 0.5rem;
      }
    }
  </style>
</head>

<body class="bg-gray-50">
  <div class="flex h-screen">
    <!-- Sidebar (will be loaded dynamically) -->
    <div id="sidebar-container"></div>
    
    <!-- Main content -->
    <div class="w-full lg:ml-64 flex flex-col flex-1 min-h-screen">
      <!-- Top Navigation (will be loaded dynamically) -->
      <div id="header-container"></div>
      
      <!-- Main content area -->
      <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-3 sm:p-4 md:p-6 w-full">
        <!-- Page Header -->
        <div class="mb-4 md:mb-6">
          <h1 class="text-xl sm:text-2xl font-bold text-gray-900 mb-1 sm:mb-2">
            <i class="fas fa-chalkboard-teacher text-primary-600 mr-2"></i>
            Faculty Management
          </h1>
          <p class="text-sm sm:text-base text-gray-600">Manage faculty members, assignments, and evaluations</p>
        </div>

        <!-- Summary Stats -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6 mb-4 md:mb-6 stats-grid">
          <!-- Total Faculty -->
          <div class="bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200 dashboard-card">
            <div class="p-3 sm:p-4 md:p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0">
                  <div class="w-8 h-8 sm:w-10 sm:h-10 bg-blue-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-chalkboard-teacher text-white text-xs sm:text-sm"></i>
                  </div>
                </div>
                <div class="ml-2 sm:ml-3 md:ml-4 lg:ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-xs sm:text-sm font-medium text-gray-500 truncate">Total Faculty</dt>
                    <dd id="total-faculty" class="text-base sm:text-lg font-medium text-gray-900">-</dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <!-- Active Faculty -->
          <div class="bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200 dashboard-card">
            <div class="p-3 sm:p-4 md:p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0">
                  <div class="w-8 h-8 sm:w-10 sm:h-10 bg-green-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-user-check text-white text-xs sm:text-sm"></i>
                  </div>
                </div>
                <div class="ml-2 sm:ml-3 md:ml-4 lg:ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-xs sm:text-sm font-medium text-gray-500 truncate">Active</dt>
                    <dd id="active-faculty" class="text-base sm:text-lg font-medium text-gray-900">-</dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <!-- Departments -->
          <div class="bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200 dashboard-card">
            <div class="p-3 sm:p-4 md:p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0">
                  <div class="w-8 h-8 sm:w-10 sm:h-10 bg-purple-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-building text-white text-xs sm:text-sm"></i>
                  </div>
                </div>
                <div class="ml-2 sm:ml-3 md:ml-4 lg:ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-xs sm:text-sm font-medium text-gray-500 truncate">Departments</dt>
                    <dd id="total-departments" class="text-base sm:text-lg font-medium text-gray-900">-</dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <!-- Total Subjects -->
          <div class="bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200 dashboard-card">
            <div class="p-3 sm:p-4 md:p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0">
                  <div class="w-8 h-8 sm:w-10 sm:h-10 bg-yellow-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-book text-white text-xs sm:text-sm"></i>
                  </div>
                </div>
                <div class="ml-2 sm:ml-3 md:ml-4 lg:ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-xs sm:text-sm font-medium text-gray-500 truncate">Total Subjects</dt>
                    <dd id="total-subjects" class="text-base sm:text-lg font-medium text-gray-900">-</dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Search and Filters -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-3 sm:p-4 mb-4 md:mb-6">
          <div class="flex flex-col lg:flex-row gap-3 sm:gap-4 filter-container">
            <!-- Search Bar -->
            <div class="flex-1 min-w-0">
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fas fa-search text-gray-400 text-sm"></i>
                </div>
                <input type="text" id="faculty-search" placeholder="Search faculty by name, email, or ID..." 
                       class="w-full pl-9 sm:pl-10 pr-3 sm:pr-4 py-2 text-sm sm:text-base border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent min-h-[44px]">
              </div>
            </div>
            
            <!-- Department Filter -->
            <div class="w-full lg:w-48">
              <select id="department-filter" class="w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent min-h-[44px]">
                <option value="">All Departments</option>
              </select>
            </div>
            
            <!-- Status Filter -->
            <div class="w-full lg:w-48">
              <select id="status-filter" class="w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent min-h-[44px]">
                <option value="">All Status</option>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Faculty Table -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
          <div class="px-3 sm:px-4 py-3 border-b border-gray-200 bg-gray-50">
            <h3 class="text-base sm:text-lg font-medium text-gray-900">
              <i class="fas fa-list mr-2 text-primary-600"></i>
              Faculty List
            </h3>
          </div>
          
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-2 sm:px-3 md:px-4 lg:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Faculty</th>
                  <th class="hidden md:table-cell px-2 sm:px-3 md:px-4 lg:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hide-mobile">Department</th>
                  <th class="hidden lg:table-cell px-2 sm:px-3 md:px-4 lg:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                  <th class="px-2 sm:px-3 md:px-4 lg:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subjects Taught</th>
                  <th class="px-2 sm:px-3 md:px-4 lg:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="faculty-table-body" class="bg-white divide-y divide-gray-200">
                <!-- Faculty will be loaded dynamically -->
              </tbody>
            </table>
          </div>
          
          <!-- Loading State -->
          <div id="loading-state" class="flex items-center justify-center py-8 sm:py-12">
            <div class="animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-primary-500"></div>
            <span class="ml-2 text-sm sm:text-base text-gray-600">Loading faculty...</span>
          </div>
          
          <!-- Empty State -->
          <div id="empty-state" class="hidden text-center py-8 sm:py-12 px-4">
            <div class="w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-2 sm:mb-3">
              <i class="fas fa-chalkboard-teacher text-gray-400 text-xl sm:text-2xl"></i>
            </div>
            <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-2">No Faculty Found</h3>
            <p class="text-sm sm:text-base text-gray-500">No faculty members match your current search criteria.</p>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Faculty Details Modal -->
  <div id="faculty-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
    <div class="relative top-0 sm:top-20 mx-auto p-3 sm:p-5 border w-full sm:w-11/12 md:w-3/4 lg:w-2/3 xl:w-1/2 shadow-lg sm:rounded-md bg-white max-w-full sm:max-w-3xl h-full sm:h-auto">
      <div class="mt-2 sm:mt-3">
        <!-- Modal Header -->
        <div class="flex items-center justify-between mb-3 sm:mb-4 border-b pb-3">
          <h3 class="text-base sm:text-lg font-medium text-gray-900">
            <i class="fas fa-user-circle text-primary-600 mr-2"></i>
            Faculty Details
          </h3>
          <button type="button" id="close-modal" class="text-gray-400 hover:text-gray-600 p-2 min-h-[44px] min-w-[44px] flex items-center justify-center">
            <i class="fas fa-times text-lg sm:text-xl"></i>
          </button>
        </div>
        
        <!-- Modal Content -->
        <div id="modal-content" class="space-y-3 sm:space-y-4">
          <!-- Content will be loaded dynamically -->
        </div>
        
        <!-- Modal Footer -->
        <div class="flex flex-col sm:flex-row justify-end gap-2 sm:gap-0 sm:space-x-3 mt-4 border-t pt-3">
          <button type="button" id="close-modal-btn" class="w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 min-h-[44px]">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Include navigation and loading scripts -->
  <script src="{{ url_for('static', filename='js/loading-animation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/guidance-navigation.js') }}"></script>

  <script>
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      loadGuidanceNavigation('faculty-management');
      loadFacultyData();
      setupEventListeners();
    });

    let facultyData = [];
    let searchTimeout = null;

    /**
     * Load faculty data from API
     */
    function loadFacultyData() {
      // Show loading state
      document.getElementById('loading-state').style.display = 'flex';
      document.getElementById('empty-state').classList.add('hidden');
      
      fetch('/api/guidance/faculty-list')
        .then(response => {
          if (!response.ok) {
            if (response.status === 401) {
              showError('Authentication required. Please log in as guidance counselor.');
              return;
            }
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            facultyData = data.faculty || [];
            
            // Update summary statistics
            updateSummaryStats(data.stats);
            
            // Display faculty list
            displayFaculty(facultyData);
            
            // Populate department filter
            populateDepartmentFilter();
            
            console.log('Faculty data loaded successfully:', facultyData.length + ' faculty members');
          } else {
            showError('Failed to load faculty data: ' + (data.message || 'Unknown error'));
          }
        })
        .catch(error => {
          console.error('Error loading faculty:', error);
          showError('Error loading faculty: ' + error.message);
        })
        .finally(() => {
          document.getElementById('loading-state').style.display = 'none';
        });
    }

    /**
     * Update summary statistics
     */
    function updateSummaryStats(stats) {
      if (!stats) return;
      
      document.getElementById('total-faculty').textContent = stats.total || 0;
      document.getElementById('active-faculty').textContent = stats.active || 0;
      document.getElementById('total-departments').textContent = stats.departments || 0;
      document.getElementById('total-subjects').textContent = stats.subjects || 0;
    }

    /**
     * Populate department filter with unique departments
     */
    function populateDepartmentFilter() {
      const departmentSelect = document.getElementById('department-filter');
      const departments = [...new Set(facultyData.map(f => f.department_name).filter(d => d))];
      
      // Clear existing options except "All Departments"
      departmentSelect.innerHTML = '<option value="">All Departments</option>';
      
      departments.sort().forEach(dept => {
        const option = document.createElement('option');
        option.value = dept;
        option.textContent = dept;
        departmentSelect.appendChild(option);
      });
    }

    /**
     * Display faculty in table
     */
    function displayFaculty(faculty) {
      const tbody = document.getElementById('faculty-table-body');
      const loadingState = document.getElementById('loading-state');
      const emptyState = document.getElementById('empty-state');
      
      loadingState.style.display = 'none';
      
      if (faculty.length === 0) {
        tbody.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      
      tbody.innerHTML = faculty.map(f => {
        const initials = f.first_name.charAt(0) + f.last_name.charAt(0);
        const fullName = `${f.first_name} ${f.last_name}`;
        const statusClass = f.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800';
        
        return `
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="px-2 sm:px-3 md:px-4 lg:px-6 py-2 sm:py-2.5 md:py-3 lg:py-4">
              <div class="flex items-center gap-1.5 sm:gap-2 md:gap-3 min-w-0">
                <div class="h-7 w-7 sm:h-8 sm:w-8 md:h-9 md:w-9 lg:h-10 lg:w-10 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0">
                  <span class="text-xs sm:text-xs md:text-sm font-medium text-primary-600">${initials}</span>
                </div>
                <div class="min-w-0 flex-1">
                  <div class="text-xs sm:text-xs md:text-sm font-medium text-gray-900 truncate">${fullName}</div>
                  <div class="text-[0.65rem] sm:text-xs text-gray-500 truncate md:hidden">${f.department_name || 'N/A'}</div>
                </div>
              </div>
            </td>
            <td class="hidden md:table-cell px-2 sm:px-3 md:px-4 lg:px-6 py-2 sm:py-2.5 md:py-3 lg:py-4 text-xs md:text-sm text-gray-900 hide-mobile">
              <div class="max-w-[150px] lg:max-w-xs truncate">${f.department_name || 'N/A'}</div>
            </td>
            <td class="hidden lg:table-cell px-2 sm:px-3 md:px-4 lg:px-6 py-2 sm:py-2.5 md:py-3 lg:py-4 text-xs lg:text-sm text-gray-500">
              <div class="max-w-[180px] xl:max-w-xs truncate">${f.email || 'Not provided'}</div>
            </td>
            <td class="px-2 sm:px-3 md:px-4 lg:px-6 py-2 sm:py-2.5 md:py-3 lg:py-4">
              <div class="max-w-[120px] sm:max-w-[150px] md:max-w-xs">
                ${f.subjects && f.subjects.length > 0 
                  ? f.subjects.slice(0, 2).map(s => `<span class="inline-flex items-center px-1.5 sm:px-2 py-0.5 mr-1 mb-1 rounded text-[0.65rem] sm:text-xs font-medium bg-blue-100 text-blue-800">${s.subject_code}</span>`).join('') 
                    + (f.subjects.length > 2 ? `<span class="text-[0.65rem] sm:text-xs text-gray-500 whitespace-nowrap">+${f.subjects.length - 2}</span>` : '')
                  : '<span class="text-[0.65rem] sm:text-xs text-gray-400">None</span>'
                }
              </div>
            </td>
            <td class="px-2 sm:px-3 md:px-4 lg:px-6 py-2 sm:py-2.5 md:py-3 lg:py-4 whitespace-nowrap">
              <button onclick="viewFacultyDetails(${f.faculty_id})" 
                      class="text-primary-600 hover:text-primary-900 transition-colors inline-flex items-center gap-1 px-2 py-1.5 rounded hover:bg-primary-50 min-h-[40px] sm:min-h-[36px] text-xs sm:text-sm font-medium">
                <i class="fas fa-eye"></i>
                <span class="hidden sm:inline">View</span>
              </button>
            </td>
          </tr>
        `;
      }).join('');
    }

    /**
     * Setup event listeners
     */
    function setupEventListeners() {
      // Search functionality with debouncing
      document.getElementById('faculty-search').addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(filterFaculty, 300);
      });
      
      document.getElementById('department-filter').addEventListener('change', filterFaculty);
      document.getElementById('status-filter').addEventListener('change', filterFaculty);
      
      // Modal events
      document.getElementById('close-modal').addEventListener('click', closeModal);
      document.getElementById('close-modal-btn').addEventListener('click', closeModal);
      
      // Keyboard events
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          const modal = document.getElementById('faculty-modal');
          if (!modal.classList.contains('hidden')) {
            closeModal();
          }
        }
      });
      
      // Click outside modal to close
      document.getElementById('faculty-modal').addEventListener('click', function(event) {
        if (event.target === this) {
          closeModal();
        }
      });
    }

    /**
     * Filter faculty based on search and filters
     */
    function filterFaculty() {
      const searchTerm = document.getElementById('faculty-search').value.toLowerCase().trim();
      const departmentFilter = document.getElementById('department-filter').value;
      const statusFilter = document.getElementById('status-filter').value;
      
      console.log('Filtering with:', { searchTerm, departmentFilter, statusFilter });
      
      const filteredFaculty = facultyData.filter(faculty => {
        const fullName = `${faculty.first_name} ${faculty.last_name}`.toLowerCase();
        const facultyIdStr = String(faculty.faculty_id || '').toLowerCase();
        const emailStr = (faculty.email || '').toLowerCase();
        const facultyStatus = (faculty.status || 'Active').toLowerCase();
        
        const matchesSearch = !searchTerm || 
          fullName.includes(searchTerm) ||
          facultyIdStr.includes(searchTerm) ||
          emailStr.includes(searchTerm);
        
        const matchesDepartment = !departmentFilter || faculty.department_name === departmentFilter;
        const matchesStatus = !statusFilter || facultyStatus === statusFilter.toLowerCase();
        
        return matchesSearch && matchesDepartment && matchesStatus;
      });
      
      console.log(`Filtered ${filteredFaculty.length} faculty from ${facultyData.length} total`);
      displayFaculty(filteredFaculty);
    }

    /**
     * View faculty details in modal
     */
    function viewFacultyDetails(facultyId) {
      // Convert to number for comparison if needed
      const id = typeof facultyId === 'string' ? parseInt(facultyId) : facultyId;
      const faculty = facultyData.find(f => f.faculty_id === id || f.faculty_id == facultyId);
      
      if (!faculty) {
        console.error('Faculty not found. Looking for ID:', facultyId, 'Type:', typeof facultyId);
        console.log('Available faculty IDs:', facultyData.map(f => f.faculty_id));
        showError('Faculty not found');
        return;
      }
      
      const modalContent = document.getElementById('modal-content');
      const fullName = `${faculty.first_name} ${faculty.last_name}`;
      
      // Build subjects list
      let subjectsList = '<p class="text-sm text-gray-500">No subjects assigned</p>';
      if (faculty.subjects && faculty.subjects.length > 0) {
        subjectsList = `
          <div class="space-y-2 max-h-[40vh] overflow-y-auto">
            ${faculty.subjects.map(subject => `
              <div class="flex items-center justify-between p-2 sm:p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                <div class="flex-1 min-w-0">
                  <div class="text-xs sm:text-sm font-medium text-gray-900 truncate">${subject.subject_code || 'N/A'}</div>
                  <div class="text-xs text-gray-500 truncate">${subject.subject_name || 'Unknown Subject'}</div>
                </div>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      modalContent.innerHTML = `
        <div class="flex items-center justify-center mb-3 sm:mb-4">
          <div class="h-14 w-14 sm:h-16 sm:w-16 rounded-full bg-primary-100 flex items-center justify-center">
            <span class="text-lg sm:text-xl font-medium text-primary-600">${faculty.first_name.charAt(0)}${faculty.last_name.charAt(0)}</span>
          </div>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
          <div class="col-span-1 sm:col-span-2">
            <label class="block text-xs font-medium text-gray-500 mb-1">Full Name</label>
            <p class="text-sm sm:text-base font-medium text-gray-900">${fullName}</p>
          </div>
          
          <div>
            <label class="block text-xs font-medium text-gray-500 mb-1">Faculty ID</label>
            <p class="text-sm sm:text-base font-medium text-gray-900">${faculty.faculty_id}</p>
          </div>
          
          <div>
            <label class="block text-xs font-medium text-gray-500 mb-1">Status</label>
            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${faculty.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
              ${faculty.status || 'Active'}
            </span>
          </div>
          
          <div class="col-span-1 sm:col-span-2">
            <label class="block text-xs font-medium text-gray-500 mb-1">Email</label>
            <p class="text-sm sm:text-base text-gray-900 break-all">${faculty.email || 'Not provided'}</p>
          </div>
          
          <div class="col-span-1 sm:col-span-2">
            <label class="block text-xs font-medium text-gray-500 mb-1">Department</label>
            <p class="text-sm sm:text-base text-gray-900">${faculty.department_name || 'N/A'}</p>
          </div>
          
          <div>
            <label class="block text-xs font-medium text-gray-500 mb-1">Total Subjects</label>
            <p class="text-sm sm:text-base text-gray-900">${faculty.subject_count || 0} subjects</p>
          </div>
        </div>
        
        <div class="mt-4">
          <label class="block text-xs font-medium text-gray-500 mb-2">Subjects Taught</label>
          ${subjectsList}
        </div>
      `;
      
      // Show modal
      document.getElementById('faculty-modal').classList.remove('hidden');
    }

    /**
     * Close modal
     */
    function closeModal() {
      document.getElementById('faculty-modal').classList.add('hidden');
    }

    /**
     * Show error message
     */
    function showError(message) {
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: message,
        confirmButtonColor: '#0059cc'
      });
    }

    /**
     * Show success message
     */
    function showSuccess(message) {
      Swal.fire({
        icon: 'success',
        title: 'Success',
        text: message,
        timer: 3000,
        showConfirmButton: false
      });
    }
  </script>
  
  <!-- Prevent logout on browser back button -->
  <script src="{{ url_for('static', filename='js/prevent-back-logout.js') }}"></script>

  <!-- Session Timeout Monitor (Auto-logout after 1 hour) -->
  <script src="{{ url_for('static', filename='js/session-timeout.js') }}"></script>
</body>
</html>
